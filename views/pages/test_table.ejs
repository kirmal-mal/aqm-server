<!DOCTYPE html>
<html>
<head>
  <% include ../partials/header.ejs %>
  <script>
    window.onload = function() {
    
    var dataPoints = [];
    
    var chart = new CanvasJS.Chart("chartContainer", {
        theme: "light2",
        title: {
            text: "Live Data"
        },
        data: [{
            type: "line",
            dataPoints: dataPoints
        }]
    });
    updateData();
    
    // Initial Values
    var xValue = 0;
    var yValue = 10;
    var newDataCount = 6;
    
    function addData(data) {
        if(newDataCount != 1) {
            $.each(data, function(key, value) {
                dataPoints.push({x: value[0], y: parseInt(value[1])});
                xValue++;
                yValue = parseInt(value[1]);
            });
        } else {
            //dataPoints.shift();
            dataPoints.push({x: xValue, y: data.tvoc});
            xValue++;
            yValue = data.tvoc;
        }
        
        newDataCount = 1;
        chart.render();
        setTimeout(updateData, 1500);
    }
    
    function updateData() {
        $.getJSON("https://sd-env-logs-server.herokuapp.com/getlogs?device_id=9", addData);
    }
    
    }
    </script>
    </head>
    <body>
    <div id="chartContainer" style="height: 300px; width: 100%;"></div>
    <script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
    <script src="https://canvasjs.com/assets/script/jquery.canvasjs.min.js"></script>
</head>

<body>
<div class="container">
<h2>Database Results</h2>


<table border="1">
  <caption>Table Caption</caption>
  <thead>
    <tr>
     <th>ID</th>
     <th>Date</th>
     <th>Environment Data</th>
    </tr>
  </thead>
  <tbody>
    <% results.forEach(function(r) { %>
      <tr>
        <td><%= r.id %></td> 
        <td><%= r.date %></td> 
        <td><%= r.env_data %></td>
      </tr>
    <% }); %>
  </tbody>
</table>


</div>

</body>
</html>
